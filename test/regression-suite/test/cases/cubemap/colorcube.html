<html>
  <head>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge" />

      <script type="text/javascript" src="../../../../x3dom-full_include.js"></script>
  </head>
  
  <body>

    <X3D xmlns='http://www.web3d.org/specifications/x3d-namespace' showStat='false' showLog='true' width="800px" height="600px">
      <Scene DEF='scene'>
        <Viewpoint position="0 0 4"></Viewpoint>
        <Background id='back1' 
            backUrl='"https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/cubemap/ocean_3_back.jpg"'
            bottomUrl='"https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/cubemap/ocean_3_bottom.jpg"'
            frontUrl='"https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/cubemap/ocean_3_front.jpg"' 
            leftUrl='"https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/cubemap/ocean_3_left.jpg"'
            rightUrl='"https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/cubemap/ocean_3_right.jpg"'
            topUrl='"https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/cubemap/ocean_3_top.jpg"'>
        </Background>
        <!--Background id='back2' 
            backUrl='"./bBK.png"' bottomUrl='"./bDN.png"'
            frontUrl='"./bFR.png"' leftUrl='"./bLF.png"'
            rightUrl='"./bRT.png"' topUrl='"./bUP.png"'>
        </Background-->
        <Group DEF='MIRROR_SCENE'>
          <Transform translation='0 0 10'>
            <Shape>
              <Appearance></Appearance>
              <Box></Box>
            </Shape>
          </Transform>
        </Group>  
        <Transform>
          <Shape DEF='mirrorSphere'>
            <Appearance>
                <Material diffuseColor=".7 .7 .7" specularColor=".5 .5 .5" shininess='100.0'></Material>
                <ComposedCubeMapTexture repeatS="false" repeatT="false">
                    <ImageTexture containerField="back" url="https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/imageFormats/test_image.jpg"></ImageTexture>
                    <ImageTexture containerField="bottom" url="https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/imageFormats/test_image.png"></ImageTexture>
                    <ImageTexture containerField="front" url="https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/imageFormats/test_image.jpg"></ImageTexture>
                    <ImageTexture containerField="left" url="https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/imageFormats/test_image.gif"></ImageTexture>
                    <ImageTexture containerField="right" url="https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/imageFormats/test_image.gif"></ImageTexture>
                    <ImageTexture containerField="top" url="https://raw.githubusercontent.com/andreasplesch/x3dom/cubemap/test/regression-suite/test/cases/imageFormats/test_image.png"></ImageTexture>
                </ComposedCubeMapTexture>
            </Appearance>
            <Sphere solid="false" ></Sphere>
          </Shape>
        </Transform>
        
      </Scene>
    </X3D>
  </body>
  <script>
    var x3d=document.createElement('X3D');
    x3d.setAttribute('width','256');
    x3d.setAttribute('height','256');
    var scene=document.querySelector('Scene');
    x3d.appendChild(scene.cloneNode(true));
    var vp=x3d.querySelector('viewpoint');
    vp.setAttribute('position','0,0,0'); // center of sphere
    vp.setAttribute('orientation','0,1,0,3.1415'); // look to front
    x3d.onload=function(){
      var objectUrl;
      x3d.querySelector('canvas').toBlob(function(blob) {
        objectUrl = URL.createObjectUrl(blob); });
      scene.querySelector('ImageTexture[containerField=front]').url = objectUrl;
    }
    document.body.appendChild(x3d);
    
  </script>
</html>
